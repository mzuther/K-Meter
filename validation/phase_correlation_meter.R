# ----------------------------------------------------------------------------
#
#  K-Meter
#  =======
#  Implementation of a K-System meter according to Bob Katz' specifications
#
#  Copyright (c) 2010-2024 Martin Zuther (http://www.mzuther.de/)
#
#  This program is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
#  Thank you for using free software!
#
# ----------------------------------------------------------------------------

#*******************
# Functions
#*******************

calculate_cross_correlation <- function(x, y)
{
  cross_correlation <- ccf(x=x, y=y, lag.max=0, type="correlation", plot=FALSE, na.action = na.fail)

  return (round(cross_correlation$acf[1], 2))
}



#*******************
# Data
#*******************

# first 100 samples of "phase_correlation_meter.flac" (right channel
# at 00:24.000)
shift_00 <- c(
  0.000000000,  0.010040283,  0.020080566,  0.030120850,  0.040161133,
  0.050231934,  0.060272217,  0.070312500,  0.080352783,  0.090423584,
  0.100463870,  0.110504150,  0.120544430,  0.130615230,  0.140655520,
  0.150695800,  0.160736080,  0.170806880,  0.180847170,  0.190887450,
  0.200927730,  0.210998540,  0.221038820,  0.231079100,  0.241119380,
  0.251159670,  0.241119380,  0.231079100,  0.221038820,  0.210998540,
  0.200927730,  0.190887450,  0.180847170,  0.170806880,  0.160736080,
  0.150695800,  0.140655520,  0.130615230,  0.120544430,  0.110504150,
  0.100463870,  0.090423584,  0.080352783,  0.070312500,  0.060272217,
  0.050231934,  0.040161133,  0.030120850,  0.020080566,  0.010040283,
  0.000000000, -0.010040283, -0.020080566, -0.030120850, -0.040161133,
 -0.050231934, -0.060272217, -0.070312500, -0.080352783, -0.090423584,
 -0.100463870, -0.110504150, -0.120544430, -0.130615230, -0.140655520,
 -0.150695800, -0.160736080, -0.170806880, -0.180847170, -0.190887450,
 -0.200927730, -0.210998540, -0.221038820, -0.231079100, -0.241119380,
 -0.251159670, -0.241119380, -0.231079100, -0.221038820, -0.210998540,
 -0.200927730, -0.190887450, -0.180847170, -0.170806880, -0.160736080,
 -0.150695800, -0.140655520, -0.130615230, -0.120544430, -0.110504150,
 -0.100463870, -0.090423584, -0.080352783, -0.070312500, -0.060272217,
 -0.050231934, -0.040161133, -0.030120850, -0.020080566, -0.010040283
)

# first 100 samples of "phase_correlation_meter.flac" (right channel
# at 00:29.000)
shift_10 <- c(
  0.100463870,  0.110504150,  0.120544430,  0.130615230,  0.140655520,
  0.150695800,  0.160736080,  0.170806880,  0.180847170,  0.190887450,
  0.200927730,  0.210998540,  0.221038820,  0.231079100,  0.241119380,
  0.251159670,  0.241119380,  0.231079100,  0.221038820,  0.210998540,
  0.200927730,  0.190887450,  0.180847170,  0.170806880,  0.160736080,
  0.150695800,  0.140655520,  0.130615230,  0.120544430,  0.110504150,
  0.100463870,  0.090423584,  0.080352783,  0.070312500,  0.060272217,
  0.050231934,  0.040161133,  0.030120850,  0.020080566,  0.010040283,
  0.000000000, -0.010040283, -0.020080566, -0.030120850, -0.040161133,
 -0.050231934, -0.060272217, -0.070312500, -0.080352783, -0.090423584,
 -0.100463870, -0.110504150, -0.120544430, -0.130615230, -0.140655520,
 -0.150695800, -0.160736080, -0.170806880, -0.180847170, -0.190887450,
 -0.200927730, -0.210998540, -0.221038820, -0.231079100, -0.241119380,
 -0.251159670, -0.241119380, -0.231079100, -0.221038820, -0.210998540,
 -0.200927730, -0.190887450, -0.180847170, -0.170806880, -0.160736080,
 -0.150695800, -0.140655520, -0.130615230, -0.120544430, -0.110504150,
 -0.100463870, -0.090423584, -0.080352783, -0.070312500, -0.060272217,
 -0.050231934, -0.040161133, -0.030120850, -0.020080566, -0.010040283,
  0.000000000,  0.010040283,  0.020080566,  0.030120850,  0.040161133,
  0.050231934,  0.060272217,  0.070312500,  0.080352783,  0.090423584
)

# first 100 samples of "phase_correlation_meter.flac" (right channel
# at 00:34.000)
shift_20 <- c(
  0.200927730,  0.210998540,  0.221038820,  0.231079100,  0.241119380,
  0.251159670,  0.241119380,  0.231079100,  0.221038820,  0.210998540,
  0.200927730,  0.190887450,  0.180847170,  0.170806880,  0.160736080,
  0.150695800,  0.140655520,  0.130615230,  0.120544430,  0.110504150,
  0.100463870,  0.090423584,  0.080352783,  0.070312500,  0.060272217,
  0.050231934,  0.040161133,  0.030120850,  0.020080566,  0.010040283,
  0.000000000, -0.010040283, -0.020080566, -0.030120850, -0.040161133,
 -0.050231934, -0.060272217, -0.070312500, -0.080352783, -0.090423584,
 -0.100463870, -0.110504150, -0.120544430, -0.130615230, -0.140655520,
 -0.150695800, -0.160736080, -0.170806880, -0.180847170, -0.190887450,
 -0.200927730, -0.210998540, -0.221038820, -0.231079100, -0.241119380,
 -0.251159670, -0.241119380, -0.231079100, -0.221038820, -0.210998540,
 -0.200927730, -0.190887450, -0.180847170, -0.170806880, -0.160736080,
 -0.150695800, -0.140655520, -0.130615230, -0.120544430, -0.110504150,
 -0.100463870, -0.090423584, -0.080352783, -0.070312500, -0.060272217,
 -0.050231934, -0.040161133, -0.030120850, -0.020080566, -0.010040283,
  0.000000000,  0.010040283,  0.020080566,  0.030120850,  0.040161133,
  0.050231934,  0.060272217,  0.070312500,  0.080352783,  0.090423584,
  0.100463870,  0.110504150,  0.120544430,  0.130615230,  0.140655520,
  0.150695800,  0.160736080,  0.170806880,  0.180847170,  0.190887450
)

# first 100 samples of "phase_correlation_meter.flac" (right channel
# at 00:39.000)
shift_30 <- c(
  0.200927730,  0.190887450,  0.180847170,  0.170806880,  0.160736080,
  0.150695800,  0.140655520,  0.130615230,  0.120544430,  0.110504150,
  0.100463870,  0.090423584,  0.080352783,  0.070312500,  0.060272217,
  0.050231934,  0.040161133,  0.030120850,  0.020080566,  0.010040283,
  0.000000000, -0.010040283, -0.020080566, -0.030120850, -0.040161133,
 -0.050231934, -0.060272217, -0.070312500, -0.080352783, -0.090423584,
 -0.100463870, -0.110504150, -0.120544430, -0.130615230, -0.140655520,
 -0.150695800, -0.160736080, -0.170806880, -0.180847170, -0.190887450,
 -0.200927730, -0.210998540, -0.221038820, -0.231079100, -0.241119380,
 -0.251159670, -0.241119380, -0.231079100, -0.221038820, -0.210998540,
 -0.200927730, -0.190887450, -0.180847170, -0.170806880, -0.160736080,
 -0.150695800, -0.140655520, -0.130615230, -0.120544430, -0.110504150,
 -0.100463870, -0.090423584, -0.080352783, -0.070312500, -0.060272217,
 -0.050231934, -0.040161133, -0.030120850, -0.020080566, -0.010040283,
  0.000000000,  0.010040283,  0.020080566,  0.030120850,  0.040161133,
  0.050231934,  0.060272217,  0.070312500,  0.080352783,  0.090423584,
  0.100463870,  0.110504150,  0.120544430,  0.130615230,  0.140655520,
  0.150695800,  0.160736080,  0.170806880,  0.180847170,  0.190887450,
  0.200927730,  0.210998540,  0.221038820,  0.231079100,  0.241119380,
  0.251159670,  0.241119380,  0.231079100,  0.221038820,  0.210998540
)

# first 100 samples of "phase_correlation_meter.flac" (right channel
# at 00:44.000)
shift_40 <- c(
  0.100463870,  0.090423584,  0.080352783,  0.070312500,  0.060272217,
  0.050231934,  0.040161133,  0.030120850,  0.020080566,  0.010040283,
  0.000000000, -0.010040283, -0.020080566, -0.030120850, -0.040161133,
 -0.050231934, -0.060272217, -0.070312500, -0.080352783, -0.090423584,
 -0.100463870, -0.110504150, -0.120544430, -0.130615230, -0.140655520,
 -0.150695800, -0.160736080, -0.170806880, -0.180847170, -0.190887450,
 -0.200927730, -0.210998540, -0.221038820, -0.231079100, -0.241119380,
 -0.251159670, -0.241119380, -0.231079100, -0.221038820, -0.210998540,
 -0.200927730, -0.190887450, -0.180847170, -0.170806880, -0.160736080,
 -0.150695800, -0.140655520, -0.130615230, -0.120544430, -0.110504150,
 -0.100463870, -0.090423584, -0.080352783, -0.070312500, -0.060272217,
 -0.050231934, -0.040161133, -0.030120850, -0.020080566, -0.010040283,
  0.000000000,  0.010040283,  0.020080566,  0.030120850,  0.040161133,
  0.050231934,  0.060272217,  0.070312500,  0.080352783,  0.090423584,
  0.100463870,  0.110504150,  0.120544430,  0.130615230,  0.140655520,
  0.150695800,  0.160736080,  0.170806880,  0.180847170,  0.190887450,
  0.200927730,  0.210998540,  0.221038820,  0.231079100,  0.241119380,
  0.251159670,  0.241119380,  0.231079100,  0.221038820,  0.210998540,
  0.200927730,  0.190887450,  0.180847170,  0.170806880,  0.160736080,
  0.150695800,  0.140655520,  0.130615230,  0.120544430,  0.110504150
)

# first 100 samples of "phase_correlation_meter.flac" (right channel
# at 00:49.000)
shift_50 <- c(
  0.000000000, -0.010040283, -0.020080566, -0.030120850, -0.040161133,
 -0.050231934, -0.060272217, -0.070312500, -0.080352783, -0.090423584,
 -0.100463870, -0.110504150, -0.120544430, -0.130615230, -0.140655520,
 -0.150695800, -0.160736080, -0.170806880, -0.180847170, -0.190887450,
 -0.200927730, -0.210998540, -0.221038820, -0.231079100, -0.241119380,
 -0.251159670, -0.241119380, -0.231079100, -0.221038820, -0.210998540,
 -0.200927730, -0.190887450, -0.180847170, -0.170806880, -0.160736080,
 -0.150695800, -0.140655520, -0.130615230, -0.120544430, -0.110504150,
 -0.100463870, -0.090423584, -0.080352783, -0.070312500, -0.060272217,
 -0.050231934, -0.040161133, -0.030120850, -0.020080566, -0.010040283,
  0.000000000,  0.010040283,  0.020080566,  0.030120850,  0.040161133,
  0.050231934,  0.060272217,  0.070312500,  0.080352783,  0.090423584,
  0.100463870,  0.110504150,  0.120544430,  0.130615230,  0.140655520,
  0.150695800,  0.160736080,  0.170806880,  0.180847170,  0.190887450,
  0.200927730,  0.210998540,  0.221038820,  0.231079100,  0.241119380,
  0.251159670,  0.241119380,  0.231079100,  0.221038820,  0.210998540,
  0.200927730,  0.190887450,  0.180847170,  0.170806880,  0.160736080,
  0.150695800,  0.140655520,  0.130615230,  0.120544430,  0.110504150,
  0.100463870,  0.090423584,  0.080352783,  0.070312500,  0.060272217,
  0.050231934,  0.040161133,  0.030120850,  0.020080566,  0.010040283
)



#*******************
# Evalutaion
#*******************

calculate_cross_correlation(x=shift_00, y=shift_00)
calculate_cross_correlation(x=shift_00, y=shift_10)
calculate_cross_correlation(x=shift_00, y=shift_20)
calculate_cross_correlation(x=shift_00, y=shift_30)
calculate_cross_correlation(x=shift_00, y=shift_40)
calculate_cross_correlation(x=shift_00, y=shift_50)
